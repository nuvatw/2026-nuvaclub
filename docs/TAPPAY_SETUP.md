# TapPay è¨­å®šæŒ‡å—

æœ¬å°ˆæ¡ˆä½¿ç”¨ TapPay ä½œç‚ºä»˜æ¬¾é–˜é“ã€‚è«‹ä¾ç…§ä»¥ä¸‹æ­¥é©Ÿè¨­å®šï¼š

## 1. å–å¾— TapPay æ†‘è­‰

1. å‰å¾€ [TapPay Portal](https://portal.tappaysdk.com/) è¨»å†Šä¸¦ç™»å…¥
2. å»ºç«‹æ‡‰ç”¨ç¨‹å¼ä¸¦å–å¾—ä»¥ä¸‹æ†‘è­‰ï¼š
   - **App ID**: å‰ç«¯ SDK ä½¿ç”¨
   - **App Key**: å‰ç«¯ SDK ä½¿ç”¨
   - **Partner Key**: å¾Œç«¯ API ä½¿ç”¨
   - **Merchant ID**: å•†åº—è­˜åˆ¥ç¢¼

### é¸æ“‡æ­£ç¢ºçš„ Merchant ID

TapPay æä¾›å¤šå€‹ Merchant IDï¼Œæ¯å€‹æœ‰ä¸åŒçš„ 3D é©—è­‰è¨­å®šï¼š

| Merchant ID | æ”¶å–®å¸³è™Ÿ | 3D é©—è­‰æ¨¡å¼ | é©ç”¨æƒ…å¢ƒ |
|------------|---------|-----------|---------|
| **tppf_nuvanuva_5808002** âœ… | 8081003293 | é 3Dï¼ˆæ™ºèƒ½é¢¨æ§ï¼‰ | **æ¨è–¦ä½¿ç”¨** - ç¬¬ä¸€æ¬¡äº¤æ˜“æœƒè¦æ±‚ç°¡è¨Šé©—è­‰ï¼Œå¾ŒçºŒå¯èƒ½ä¸éœ€è¦ |
| tppf_nuvanuva_5808001 | 8081002774 | 3D é©—è­‰ + ä»£æ”¶ä»˜ | æ¯æ¬¡éƒ½è¦ç°¡è¨Šé©—è­‰ |
| tppf_nuvanuva_5803001 | 902380056 | 3D é©—è­‰ + éåˆ†æœŸ | æ¯æ¬¡éƒ½è¦ç°¡è¨Šé©—è­‰ |
| tppf_nuvanuva_82203 | 81463 | ä¸­ä¿¡å¡åˆ†æœŸå°ˆç”¨ | åƒ…æ”¯æ´ä¸­ä¿¡å¡åˆ†æœŸ |

**æ¨è–¦ä½¿ç”¨ `tppf_nuvanuva_5808002`**ï¼š
- âœ… æ™ºèƒ½é¢¨æ§ï¼šæ ¹æ“šäº¤æ˜“é¢¨éšªå‹•æ…‹æ±ºå®šæ˜¯å¦éœ€è¦ 3D é©—è­‰
- âœ… é¦–æ¬¡äº¤æ˜“é€šå¸¸æœƒè¦æ±‚ç°¡è¨Šèªè­‰ï¼ˆæé«˜å®‰å…¨æ€§ï¼‰
- âœ… å¾ŒçºŒäº¤æ˜“å¯èƒ½è·³é 3D é©—è­‰ï¼ˆæå‡ç”¨æˆ¶é«”é©—ï¼‰
- âœ… é©åˆä¸€èˆ¬é›»å•†ä½¿ç”¨

## 2. è¨­å®šç’°å¢ƒè®Šæ•¸

1. è¤‡è£½ `.env.example` ç‚º `.env.local`:
   ```bash
   cp .env.example .env.local
   ```

2. ç·¨è¼¯ `.env.local` ä¸¦å¡«å…¥æ‚¨çš„ TapPay æ†‘è­‰:
   ```env
   # å‰ç«¯ SDK è¨­å®š (å¿…å¡«)
   NEXT_PUBLIC_TAPPAY_APP_ID=your_app_id_here
   NEXT_PUBLIC_TAPPAY_APP_KEY=your_app_key_here
   
   # ç’°å¢ƒè¨­å®š
   NEXT_PUBLIC_TAPPAY_SERVER_TYPE=sandbox  # æ¸¬è©¦ç’°å¢ƒç”¨ sandboxï¼Œæ­£å¼ç’°å¢ƒç”¨ production
   
   # å¾Œç«¯ API è¨­å®š (å¿…å¡«)
   TAPPAY_PARTNER_KEY=your_partner_key_here
   TAPPAY_MERCHANT_ID=your_merchant_id_here
   ```

## 3. æ¸¬è©¦è¨­å®š

1. å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨:
   ```bash
   pnpm dev
   ```

2. å‰å¾€æ¸¬è©¦é é¢:
   ```
   http://localhost:3000/checkout-demo
   ```

3. æ¸¬è©¦ä¸åŒæƒ…å¢ƒï¼š
   - **ğŸ” First-Time Purchase (3D)**: æ¸¬è©¦é¦–æ¬¡è³¼è²·æµç¨‹ï¼Œæœƒè§¸ç™¼ 3D é©—è­‰ï¼ˆç°¡è¨Šèªè­‰ï¼‰
   - **âœ… Returning Customer**: æ¸¬è©¦å›è³¼æµç¨‹ï¼Œå¯èƒ½è·³é 3D é©—è­‰
   - å…¶ä»–æ¨™æº–çµå¸³æµç¨‹

## 4. æ¸¬è©¦å¡è™Ÿ

åœ¨ sandbox ç’°å¢ƒä¸‹ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹æ¸¬è©¦å¡è™Ÿï¼š

- **å¡è™Ÿ**: `4242 4242 4242 4242`
- **åˆ°æœŸæ—¥**: ä»»ä½•æœªä¾†æ—¥æœŸ (ä¾‹å¦‚: `12/25`)
- **CCV**: ä»»æ„ä¸‰ä½æ•¸ (ä¾‹å¦‚: `123`)

### 3D é©—è­‰æ¸¬è©¦

ä½¿ç”¨ `tppf_nuvanuva_5808002` (é 3D é©—è­‰æ¨¡å¼) æ™‚ï¼š

1. **é¦–æ¬¡äº¤æ˜“**ï¼š
   - ç³»çµ±æœƒåˆ¤æ–·ç‚ºé«˜é¢¨éšªäº¤æ˜“
   - æœƒå½ˆå‡º 3D é©—è­‰è¦–çª—è¦æ±‚ç°¡è¨Šèªè­‰
   - è¼¸å…¥æ¸¬è©¦ç°¡è¨Šé©—è­‰ç¢¼å®Œæˆä»˜æ¬¾

2. **å¾ŒçºŒäº¤æ˜“**ï¼š
   - ç³»çµ±å¯èƒ½åˆ¤æ–·ç‚ºä½é¢¨éšªäº¤æ˜“
   - å¯èƒ½ç›´æ¥å®Œæˆä»˜æ¬¾ï¼Œä¸éœ€è¦ 3D é©—è­‰
   - å…·é«”è¡Œç‚ºç”± TapPay é¢¨æ§ç³»çµ±æ±ºå®š

> **æ³¨æ„**: Sandbox ç’°å¢ƒçš„ 3D é©—è­‰è¡Œç‚ºå¯èƒ½èˆ‡æ­£å¼ç’°å¢ƒä¸åŒã€‚æ­£å¼ç’°å¢ƒæœƒæ ¹æ“šå¯¦éš›é¢¨éšªè©•ä¼°æ±ºå®šæ˜¯å¦éœ€è¦ 3D é©—è­‰ã€‚

## 5. ç’°å¢ƒè®Šæ•¸èªªæ˜

### å‰ç«¯è®Šæ•¸ (NEXT_PUBLIC_*)
é€™äº›è®Šæ•¸æœƒè¢«æ‰“åŒ…åˆ°å‰ç«¯ç¨‹å¼ç¢¼ä¸­ï¼Œå¯åœ¨ç€è¦½å™¨ä¸­ä½¿ç”¨ï¼š

- `NEXT_PUBLIC_TAPPAY_APP_ID`: TapPay App ID
- `NEXT_PUBLIC_TAPPAY_APP_KEY`: TapPay App Key
- `NEXT_PUBLIC_TAPPAY_SERVER_TYPE`: ä¼ºæœå™¨é¡å‹ (`sandbox` æˆ– `production`)
- `NEXT_PUBLIC_TAPPAY_SDK_VERSION`: SDK ç‰ˆæœ¬ (é è¨­: `v5.19.2`)

### å¾Œç«¯è®Šæ•¸
é€™äº›è®Šæ•¸åƒ…åœ¨ä¼ºæœå™¨ç«¯ä½¿ç”¨ï¼Œä¸æœƒæš´éœ²åˆ°å‰ç«¯ï¼š

- `TAPPAY_PARTNER_KEY`: ç”¨æ–¼å‘¼å« TapPay Pay by Prime API
- `TAPPAY_MERCHANT_ID`: å•†åº—è­˜åˆ¥ç¢¼

## 6. å®‰å…¨æ³¨æ„äº‹é …

âš ï¸ **é‡è¦**: 
- çµ•å°ä¸è¦å°‡ `.env.local` æäº¤åˆ° Git
- ç¢ºä¿ `.gitignore` åŒ…å« `.env*.local`
- Partner Key å’Œ Merchant ID åªèƒ½åœ¨å¾Œç«¯ä½¿ç”¨
- æ­£å¼ç’°å¢ƒè«‹ä½¿ç”¨ `production` server type

## 7. ç›¸é—œæª”æ¡ˆ

- å‰ç«¯ SDK: `src/features/checkout/components/payments/TapPayCardFields.tsx`
- å¾Œç«¯ API: `src/app/api/bff/checkout/tappay/pay-by-prime/route.ts`
- ä»˜æ¬¾æœå‹™: `src/application/services/CheckoutPaymentService.ts`
- TapPay Gateway: `src/infra/payments/tappay/TapPayGateway.ts`
